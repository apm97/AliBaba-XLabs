{
  "ROSTemplateFormatVersion": "2015-09-01",
  "Parameters": {
    "InstancePassword": {
      "Type": "String",
      "Description": "Password for the ECS instances.",
      "Default": "nkYHG890..",
      "NoEcho": true
    }
  },
  "Resources": {
    "Vpc": {
      "Type": "ALIYUN::ECS::VPC",
      "Properties": {
        "VpcName": "LabVPC",
        "CidrBlock": "10.0.0.0/16"
      }
    },
    "VSwitch": {
      "Type": "ALIYUN::ECS::VSwitch",
      "Properties": {
        "VpcId": {
          "Ref": "Vpc"
        },
        "ZoneId": {
          "Fn::Select": [
            0,
            {
              "Fn::GetAZs": {
                "Ref": "ALIYUN::Region"
              }
            }
          ]
        },
        "CidrBlock": "10.0.1.0/24"
      }
    },
    "SecurityGroup": {
      "Type": "ALIYUN::ECS::SecurityGroup",
      "Properties": {
        "VpcId": {
          "Ref": "Vpc"
        },
        "SecurityGroupIngress": [
          {
            "PortRange": "80/80",
            "Priority": 1,
            "IpProtocol": "tcp",
            "SourceCidrIp": "0.0.0.0/0"
          },
          {
            "PortRange": "22/22",
            "Priority": 1,
            "IpProtocol": "tcp",
            "SourceCidrIp": "0.0.0.0/0"
          }
        ]
      }
    },
    "ECS1": {
      "Type": "ALIYUN::ECS::Instance",
      "Properties": {
        "InstanceType": "ecs.c8y.small",
        "ImageId": "ubuntu_16_04_x64_20G_alibase_20221227.vhd",
        "InstanceName": "ECS-1",
        "SecurityGroupId": {
          "Ref": "SecurityGroup"
        },
        "VSwitchId": {
          "Ref": "VSwitch"
        },
        "InternetMaxBandwidthOut": 1,
        "Password": {
          "Ref": "InstancePassword"
        }
      }
    },
    "ECS2": {
      "Type": "ALIYUN::ECS::Instance",
      "Properties": {
        "InstanceType": "ecs.c8y.small",
        "ImageId": "ubuntu_16_04_x64_20G_alibase_20221227.vhd",
        "InstanceName": "ECS-2",
        "SecurityGroupId": {
          "Ref": "SecurityGroup"
        },
        "VSwitchId": {
          "Ref": "VSwitch"
        },
        "InternetMaxBandwidthOut": 1,
        "Password": {
          "Ref": "InstancePassword"
        }
      }
    },
    "LoadBalancer": {
      "Type": "ALIYUN::SLB::LoadBalancer",
      "Properties": {
        "LoadBalancerName": "LabCLB",
        "LoadBalancerSpec": "slb.s1.small",
        "AddressType": "internet",
        "VSwitchId": {
          "Ref": "VSwitch"
        }
      }
    }
  },
  "Outputs": {
    "ECS1_PublicIP": {
      "Description": "Public IP of the first ECS instance.",
      "Value": {
        "Fn::GetAtt": [
          "ECS1",
          "PublicIp"
        ]
      }
    },
    "ECS2_PublicIP": {
      "Description": "Public IP of the second ECS instance.",
      "Value": {
        "Fn::GetAtt": [
          "ECS2",
          "PublicIp"
        ]
      }
    },
    "LoadBalancer_IP": {
      "Description": "Public IP of the Classic Load Balancer.",
      "Value": {
        "Fn::GetAtt": [
          "LoadBalancer",
          "IpAddress"
        ]
      }
    },
    "ECS_Instance_IDs": {
      "Description": "IDs of the created ECS instances.",
      "Value": {
        "Fn::Join": [
          ", ",
          [
            {
              "Fn::GetAtt": [
                "ECS1",
                "InstanceId"
              ]
            },
            {
              "Fn::GetAtt": [
                "ECS2",
                "InstanceId"
              ]
            }
          ]
        ]
      }
    }
  }
}
